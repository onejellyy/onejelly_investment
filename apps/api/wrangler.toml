name = "onejellyinvest-api"
main = "src/index.ts"
compatibility_date = "2024-01-01"
compatibility_flags = ["nodejs_compat"]
account_id = "635e7cd89666c9e2bd86028a569f2f82"

[vars]
ENVIRONMENT = "development"
OPENDART_API_KEY = "1076bf5f1a6e5072a33e11b2ff9a49061ee53e69"
INTERNAL_API_SECRET = "onejellyinvest-internal-2026"
KRX_SOURCE = "api"
# NOTE: Do not commit API keys. Set via Worker secret instead:
#   wrangler secret put KRX_API_KEY --env production
# For local dev, use `.dev.vars` (untracked) or environment variable injection.
KRX_PUBLIC_KOSPI_URL = "https://data.krx.co.kr/comm/fileDn/GenerateOTP/generate.cmd?locale=ko_KR&mktId=STK&trdDd={date}&money=1&csvxls_isNo=false&name=fileDown&url=dbms/MDC/STAT/standard/MDCSTAT03901"
KRX_PUBLIC_KOSDAQ_URL = "https://data.krx.co.kr/comm/fileDn/GenerateOTP/generate.cmd?locale=ko_KR&mktId=KSQ&trdDd={date}&money=1&csvxls_isNo=false&name=fileDown&url=dbms/MDC/STAT/standard/MDCSTAT03901"
KRX_KOSPI_API_URL = "https://data-dbg.krx.co.kr/svc/apis/sto/stk_bydd_trd?basDd={date}"
KRX_KOSDAQ_API_URL = "https://data-dbg.krx.co.kr/svc/apis/sto/ksq_bydd_trd?basDd={date}"
# KRX_USE_MOCK = "1"

[[d1_databases]]
binding = "DB"
database_name = "onejellyinvest"
database_id = "c69bb620-8759-48c4-87ba-0bbc1b6604fa"

[ai]
binding = "AI"

# Production 환경
[env.production]

[env.production.vars]
ENVIRONMENT = "production"
OPENDART_API_KEY = "1076bf5f1a6e5072a33e11b2ff9a49061ee53e69"
INTERNAL_API_SECRET = "onejellyinvest-internal-2026"
KRX_SOURCE = "api"
# NOTE: Set via Worker secret instead (not committed):
#   wrangler secret put KRX_API_KEY --env production
KRX_PUBLIC_KOSPI_URL = "https://data.krx.co.kr/comm/fileDn/GenerateOTP/generate.cmd?locale=ko_KR&mktId=STK&trdDd={date}&money=1&csvxls_isNo=false&name=fileDown&url=dbms/MDC/STAT/standard/MDCSTAT03901"
KRX_PUBLIC_KOSDAQ_URL = "https://data.krx.co.kr/comm/fileDn/GenerateOTP/generate.cmd?locale=ko_KR&mktId=KSQ&trdDd={date}&money=1&csvxls_isNo=false&name=fileDown&url=dbms/MDC/STAT/standard/MDCSTAT03901"
KRX_KOSPI_API_URL = "https://data-dbg.krx.co.kr/svc/apis/sto/stk_bydd_trd?basDd={date}"
KRX_KOSDAQ_API_URL = "https://data-dbg.krx.co.kr/svc/apis/sto/ksq_bydd_trd?basDd={date}"

[env.production.ai]
binding = "AI"

[[env.production.d1_databases]]
binding = "DB"
database_name = "onejellyinvest-prod"
database_id = "c69bb620-8759-48c4-87ba-0bbc1b6604fa"

# Cron Triggers (production만 사용)
[env.production.triggers]
crons = [
  "*/5 * * * *",   # 기사 엔진: 5분마다
  "0 * * * *",     # 공시 엔진: 1시간마다 (매시 정각)
  "0 7 * * *"      # 시세/지표 엔진: 매일 16:00 KST (UTC 07:00)
]
